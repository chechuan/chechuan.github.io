<!DOCTYPE html><html lang="zh-TW" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>消息盒子 | 被梦的个人博客</title><meta name="author" content="车 川,1163317515@qq.com"><meta name="copyright" content="车 川"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="redis的基本操作 redis是key-value的数据结构，每条数据都是⼀个键值对  键的类型是字符串  注意：键不能重复  值的类型分为五种：  字符串string  哈希hash  列表list  集合set  有序集合zset">
<meta property="og:type" content="article">
<meta property="og:title" content="消息盒子">
<meta property="og:url" content="http://example.com/2020/11/19/%E6%B6%88%E6%81%AF%E7%9B%92%E5%AD%90/index.html">
<meta property="og:site_name" content="被梦的个人博客">
<meta property="og:description" content="redis的基本操作 redis是key-value的数据结构，每条数据都是⼀个键值对  键的类型是字符串  注意：键不能重复  值的类型分为五种：  字符串string  哈希hash  列表list  集合set  有序集合zset">
<meta property="og:locale" content="zh_TW">
<meta property="og:image" content="https://jsd.012700.xyz/gh/jerryc127/butterfly_cdn@2.1.0/top_img/index.jpg">
<meta property="article:published_time" content="2020-11-19T14:15:35.000Z">
<meta property="article:modified_time" content="2023-10-19T09:55:58.310Z">
<meta property="article:author" content="车 川">
<meta property="article:tag" content="智能高并发审批流系统">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://jsd.012700.xyz/gh/jerryc127/butterfly_cdn@2.1.0/top_img/index.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2020/11/19/%E6%B6%88%E6%81%AF%E7%9B%92%E5%AD%90/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"top_n_per_article":1,"unescape":true,"languages":{"hits_empty":"找不到您查詢的內容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '複製成功',
    error: '複製錯誤',
    noSupport: '瀏覽器不支援'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '天',
  dateSuffix: {
    just: '剛剛',
    min: '分鐘前',
    hour: '小時前',
    day: '天前',
    month: '個月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: 车 川","link":"連結: ","source":"來源: 被梦的个人博客","info":"著作權歸作者所有。商業轉載請聯繫作者獲得授權，非商業轉載請註明出處。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '載入更多'
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '消息盒子',
  isPost: true,
  isHome: false,
  isHighlightShrink: true,
  isToc: true,
  postUpdate: '2023-10-19 17:55:58'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://i.postimg.cc/kMkqZ7ym/Wechat-IMG95.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">54</div></a><a href="/tags/"><div class="headline">標籤</div><div class="length-num">15</div></a><a href="/categories/"><div class="headline">分類</div><div class="length-num">14</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://jsd.012700.xyz/gh/jerryc127/butterfly_cdn@2.1.0/top_img/index.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="被梦的个人博客"><span class="site-name">被梦的个人博客</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜尋</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">消息盒子</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">發表於</span><time class="post-meta-date-created" datetime="2020-11-19T14:15:35.000Z" title="發表於 2020-11-19 22:15:35">2020-11-19</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新於</span><time class="post-meta-date-updated" datetime="2023-10-19T09:55:58.310Z" title="更新於 2023-10-19 17:55:58">2023-10-19</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%99%BA%E8%83%BD%E9%AB%98%E5%B9%B6%E5%8F%91%E5%AE%A1%E6%89%B9%E6%B5%81%E7%B3%BB%E7%BB%9F/">智能高并发审批流系统</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="消息盒子"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">閱讀量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="redis的基本操作"><a href="#redis的基本操作" class="headerlink" title="redis的基本操作"></a>redis的基本操作</h1><ul>
<li><p>redis是key-value的数据结构，每条数据都是⼀个键值对</p>
</li>
<li><p>键的类型是字符串</p>
</li>
<li><p>注意：键不能重复</p>
</li>
<li><p>值的类型分为五种：</p>
</li>
<li><p>字符串string</p>
</li>
<li><p>哈希hash</p>
</li>
<li><p>列表list</p>
</li>
<li><p>集合set</p>
</li>
<li><p>有序集合zset</p>
<span id="more"></span></li>
<li><p>string类型</p>
</li>
<li><p>字符串类型是 Redis 中最为基础的数据存储类型，它在 Redis 中是二进制安全的，这便意味着该类型可以接受任何格式的数据，如JPEG图像数据或Json对象描述信息等。在Redis中字符串类型的Value最多可以容纳的数据长度是512M。</p>
</li>
<li><p>设置键值</p>
</li>
</ul>
<p>set key value</p>
<ul>
<li>例1：设置键为name值为itcast的数据</li>
</ul>
<p>set name itcast</p>
<ul>
<li>设置键值及过期时间，以秒为单位</li>
</ul>
<p>setex key seconds value</p>
<ul>
<li>例2：设置键为aa值为aa过期时间为3秒的数据</li>
</ul>
<p>setex aa 3 aa</p>
<ul>
<li>设置多个键值</li>
</ul>
<p>mset key1 value1 key2 value2 …</p>
<ul>
<li>例3：设置键为’a1’值为’python’、键为’a2’值为’java’、键为’a3’值为’c’</li>
</ul>
<p>mset a1 python a2 java a3 c</p>
<ul>
<li>追加值</li>
</ul>
<p>append key value</p>
<ul>
<li>例4：向键为a1中追加值’ haha’</li>
</ul>
<p>append ‘a1’ ‘haha’</p>
<h1 id="获取"><a href="#获取" class="headerlink" title="获取"></a><strong>获取</strong></h1><ul>
<li>获取：根据键获取值，如果不存在此键则返回null</li>
</ul>
<p>get key</p>
<ul>
<li>例5：获取键’name’的值</li>
</ul>
<p>get ‘name’</p>
<ul>
<li>根据多个键获取多个值</li>
</ul>
<p>mget key1 key2 …</p>
<ul>
<li>例6：获取键a1、a2、a3’的值</li>
</ul>
<p>mget a1 a2 a3</p>
<ul>
<li>查看键对应的value的类型</li>
</ul>
<p>type key</p>
<ul>
<li>例4：查看键a1的值类型，为redis⽀持的五种类型中的⼀种</li>
</ul>
<p>type a1</p>
<ul>
<li>删除键及对应的值</li>
</ul>
<p>del key1 key2 …</p>
<ul>
<li>例5：删除键a2、a3</li>
</ul>
<p>del a2 a3</p>
<ul>
<li>设置过期时间，以秒为单位</li>
<li>如果没有指定过期时间则⼀直存在，直到使⽤DEL移除</li>
</ul>
<p>expire key seconds</p>
<ul>
<li>例6：设置键’a1’的过期时间为3秒</li>
</ul>
<p>expire ‘a1’ 3</p>
<p>查看有效时间，以秒为单位</p>
<p>ttl key</p>
<h1 id="hash类型"><a href="#hash类型" class="headerlink" title="hash类型"></a><strong>hash类型</strong></h1><ul>
<li>hash⽤于存储对象，对象的结构为属性、值</li>
<li>值的类型为string</li>
<li>设置单个属性</li>
</ul>
<h2 id="增加、修改"><a href="#增加、修改" class="headerlink" title="增加、修改"></a><strong>增加、修改</strong></h2><p>hset key field value</p>
<ul>
<li>例1：设置键 user的属性name为itheima</li>
</ul>
<p>hset user name itheima</p>
<p>MISCONF Redis is configured to save RDB snapshots, but is currently not able to persist on disk. Commands that may modify the data set are disabled. Please check Redis logs for details about the error.</p>
<p>Redis被配置为保存数据库快照，但它目前不能持久化到硬盘。用来修改集合数据的命令不能用</p>
<p>原因：</p>
<ul>
<li>强制关闭Redis快照导致不能持久化。 解决方案：</li>
<li>运行config set stop-writes-on-bgsave-error no　命令后，关闭配置项stop-writes-on-bgsave-error解决该问题。</li>
<li>设置多个属性</li>
</ul>
<p>hmset key field1 value1 field2 value2 …</p>
<ul>
<li>例2：设置键u2的属性name为itcast、属性age为11</li>
</ul>
<p>hmset u2 name itcast age 11</p>
<h2 id="获取-1"><a href="#获取-1" class="headerlink" title="获取"></a><strong>获取</strong></h2><ul>
<li>获取指定键所有的属性</li>
</ul>
<p>hkeys key</p>
<ul>
<li>例3：获取键u2的所有属性</li>
</ul>
<p>hkeys u2</p>
<ul>
<li>获取⼀个属性的值</li>
</ul>
<p>hget key field</p>
<ul>
<li>例4：获取键u2属性’name’的值</li>
</ul>
<p>hget u2 ‘name’</p>
<ul>
<li>获取多个属性的值</li>
</ul>
<p>hmget key field1 field2 …</p>
<ul>
<li>例5：获取键u2属性’name’、’age的值</li>
</ul>
<p>hmget u2 name age</p>
<ul>
<li>获取所有属性的值</li>
</ul>
<p>hvals key</p>
<ul>
<li>例6：获取键’u2’所有属性的值</li>
</ul>
<p>hvals u2</p>
<h2 id="删除"><a href="#删除" class="headerlink" title="删除"></a><strong>删除</strong></h2><ul>
<li>删除整个hash键及值，使⽤del命令</li>
<li>删除属性，属性对应的值会被⼀起删除</li>
</ul>
<p>hdel key field1 field2 …</p>
<ul>
<li>例7：删除键’u2’的属性’age’</li>
</ul>
<p>hdel u2 age</p>
<h1 id="list类型"><a href="#list类型" class="headerlink" title="list类型"></a><strong>list类型</strong></h1><ul>
<li>列表的元素类型为string</li>
<li>按照插⼊顺序排序</li>
<li>在左侧插⼊数据</li>
</ul>
<h2 id="增加"><a href="#增加" class="headerlink" title="增加"></a><strong>增加</strong></h2><p>lpush key value1 value2 …</p>
<ul>
<li>例1：从键为’a1’的列表左侧加⼊数据a 、 b 、c</li>
</ul>
<p>lpush a1 a b c</p>
<ul>
<li>在右侧插⼊数据</li>
</ul>
<p>rpush key value1 value2 …</p>
<ul>
<li>例2：从键为’a1’的列表右侧加⼊数据0 1</li>
</ul>
<p>rpush a1 0 1</p>
<ul>
<li>在指定元素的前或后插⼊新元素</li>
</ul>
<p>linsert key before或after 现有元素 新元素</p>
<ul>
<li>例3：在键为’a1’的列表中元素’b’前加⼊’3’</li>
</ul>
<p>linsert a1 before b 3</p>
<h2 id="获取-2"><a href="#获取-2" class="headerlink" title="获取"></a><strong>获取</strong></h2><ul>
<li>返回列表⾥指定范围内的元素</li>
<li>start、stop为元素的下标索引</li>
<li>索引从左侧开始，第⼀个元素为0</li>
<li>索引可以是负数，表示从尾部开始计数，如-1表示最后⼀个元素</li>
</ul>
<p>lrange key start stop</p>
<ul>
<li>例4：获取键为’a1’的列表所有元素</li>
</ul>
<p>lrange a1 0 -1</p>
<h2 id="设置指定索引位置的元素值"><a href="#设置指定索引位置的元素值" class="headerlink" title="设置指定索引位置的元素值"></a><strong>设置指定索引位置的元素值</strong></h2><ul>
<li>索引从左侧开始，第⼀个元素为0</li>
<li>索引可以是负数，表示尾部开始计数，如-1表示最后⼀个元素</li>
</ul>
<p>lset key index value</p>
<ul>
<li>例5：修改键为’a1’的列表中下标为1的元素值为’z’</li>
</ul>
<p>lset a 1 z</p>
<h2 id="删除-1"><a href="#删除-1" class="headerlink" title="删除"></a><strong>删除</strong></h2><ul>
<li>删除指定元素</li>
<li>将列表中前count次出现的值为value的元素移除</li>
<li>count &gt; 0: 从头往尾移除</li>
<li>count &lt; 0: 从尾往头移除</li>
<li>count &#x3D; 0: 移除所有</li>
</ul>
<p>lrem key count value</p>
<ul>
<li>例6.1：向列表’a2’中加⼊元素’a’、’b’、’a’、’b’、’a’、’b’</li>
</ul>
<p>lpush a2 a b a b a b</p>
<ul>
<li>例6.2：从’a2’列表右侧开始删除2个’b’</li>
</ul>
<p>lrem a2 -2 b</p>
<ul>
<li>例6.3：查看列表’py12’的所有元素</li>
</ul>
<p>lrange a2 0 -1</p>
<h1 id="set类型"><a href="#set类型" class="headerlink" title="set类型"></a><strong>set类型</strong></h1><ul>
<li>⽆序集合</li>
<li>元素为string类型</li>
<li>元素具有唯⼀性，不重复</li>
<li>说明：对于集合没有修改操作</li>
<li>添加元素</li>
</ul>
<h2 id="增加-1"><a href="#增加-1" class="headerlink" title="增加"></a><strong>增加</strong></h2><p>sadd key member1 member2 …</p>
<ul>
<li>例1：向键’a3’的集合中添加元素’zhangsan’、’lisi’、’wangwu’</li>
</ul>
<p>sadd a3 zhangsan sili wangwu</p>
<h2 id="获取-3"><a href="#获取-3" class="headerlink" title="获取"></a><strong>获取</strong></h2><ul>
<li>返回所有的元素</li>
</ul>
<p>smembers key</p>
<ul>
<li>例2：获取键’a3’的集合中所有元素</li>
</ul>
<p>smembers a3</p>
<h2 id="删除-2"><a href="#删除-2" class="headerlink" title="删除"></a><strong>删除</strong></h2><ul>
<li>删除指定元素</li>
</ul>
<p>srem key</p>
<ul>
<li>例3：删除键’a3’的集合中元素’wangwu’</li>
</ul>
<p>srem a3 wangwu</p>
<h1 id="消息盒子"><a href="#消息盒子" class="headerlink" title="消息盒子"></a>消息盒子</h1><h2 id="在自定义组件中加入徽章图标-用于消息提示，使用a-badge标签。"><a href="#在自定义组件中加入徽章图标-用于消息提示，使用a-badge标签。" class="headerlink" title="在自定义组件中加入徽章图标,用于消息提示，使用a-badge标签。"></a>在自定义组件中加入徽章图标,用于消息提示，使用a-badge标签。</h2><h3 id="效果如下"><a href="#效果如下" class="headerlink" title="效果如下"></a>效果如下</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/20201110202115751.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0sxMTYzMzE3NTE1,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">a-form-item</span> <span class="attr">lable</span>=<span class="string">&quot;徽标&quot;</span> <span class="attr">v-bind</span>=<span class="string">&quot;formItemLayout&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">a-badge</span> <span class="attr">:count</span>=<span class="string">number</span> <span class="attr">show-zero</span> <span class="attr">style</span>=<span class="string">&quot;margin-left: 40px;&quot;</span> &gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/check&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;static\WeChat.jpg&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 35px&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;/<span class="name">a-badge</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">a-badge</span> <span class="attr">count</span>=<span class="string">&quot;12&quot;</span> <span class="attr">show-zero</span> <span class="attr">style</span>=<span class="string">&quot;margin-left: 40px;&quot;</span> &gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;static\tengxun.jpg&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width:35px&quot;</span> /&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;/<span class="name">a-badge</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">a-form-item</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>属性conunt就是图标右上角红色的数字,这里可以绑定数据</p>
</blockquote>
<h3 id="我们需要右上角的数字-首先绑定一个number-这个number在后端获取。"><a href="#我们需要右上角的数字-首先绑定一个number-这个number在后端获取。" class="headerlink" title="我们需要右上角的数字,首先绑定一个number,这个number在后端获取。"></a>我们需要右上角的数字,首先绑定一个number,这个number在后端获取。</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">a-layout-header</span> <span class="attr">style</span>=<span class="string">&quot;background: #fff; padding: 0&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">          </span><br><span class="line">      <span class="tag">&lt;<span class="name">a-form-item</span> <span class="attr">lable</span>=<span class="string">&quot;徽标&quot;</span> <span class="attr">v-bind</span>=<span class="string">&quot;formItemLayout&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">a-badge</span> <span class="attr">:count</span>=<span class="string">number</span> <span class="attr">show-zero</span> <span class="attr">style</span>=<span class="string">&quot;margin-left: 40px;&quot;</span> &gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/check&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;static\WeChat.jpg&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 35px&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;/<span class="name">a-badge</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">a-badge</span> <span class="attr">count</span>=<span class="string">&quot;12&quot;</span> <span class="attr">show-zero</span> <span class="attr">style</span>=<span class="string">&quot;margin-left: 40px;&quot;</span> &gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;static\tengxun.jpg&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width:35px&quot;</span> /&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;/<span class="name">a-badge</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">        &lt;a-badge :count=&quot;num&quot;  style=&quot;margin-left:100px;&quot;&gt;</span></span><br><span class="line"><span class="comment">          &lt;a href=&quot;/new_list/&quot;&gt;&lt;img src=&quot;/../../static/xiaoxi.jpg&quot;  alt=&quot;&quot; width=&quot;30px&quot; height=&quot;30px&quot;&gt;&lt;/a&gt;</span></span><br><span class="line"><span class="comment">        &lt;/a-badge&gt; --&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;/<span class="name">a-form-item</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&#x27;float: right&#x27;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">              <span class="tag">&lt;<span class="name">a-avatar</span> <span class="attr">:src</span>= <span class="string">&#x27;this.imgUrl&#x27;</span> <span class="attr">icon</span>=<span class="string">&quot;&quot;</span> <span class="attr">:size</span>=<span class="string">&quot;50&quot;</span>  <span class="attr">style</span>=<span class="string">&quot;margin-right: 129px;margin-top: -260px;&quot;</span>/&gt;</span></span><br><span class="line">             </span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">a-layout-header</span>&gt;</span></span><br><span class="line">          </span><br><span class="line">          </span><br><span class="line">        </span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    </span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">import</span> md5 <span class="keyword">from</span> <span class="string">&#x27;js-md5&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">    </span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        data () &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">number</span>:<span class="number">0</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">msg</span>: <span class="string">&quot;这是一个变量&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">images</span>: <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&#x27;images&#x27;</span>),</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">suffic</span>:<span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&#x27;suffic&#x27;</span>),</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">imgUrl</span>:<span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">collapsed</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">username</span>:<span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&#x27;username&#x27;</span>),</span></span><br><span class="line"><span class="language-javascript">            user_id : <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&#x27;user_id&#x27;</span>),</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">formItemLayout</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">              <span class="attr">labelCol</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">xs</span>: &#123; <span class="attr">span</span>: <span class="number">24</span> &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">sm</span>: &#123; <span class="attr">span</span>: <span class="number">4</span> &#125;,</span></span><br><span class="line"><span class="language-javascript">              &#125;&#125;,</span></span><br><span class="line"><span class="language-javascript">            </span></span><br><span class="line"><span class="language-javascript">          &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">methods</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="title function_">confirm</span>(<span class="params">e</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span>(<span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&#x27;user_id&#x27;</span>) &amp;&amp; <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&#x27;username&#x27;</span>))&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(e);</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">window</span>.<span class="property">localStorage</span>.<span class="title function_">clear</span>()</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">push</span>(<span class="string">&#x27;/login&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">cancel</span>(<span class="params">e</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">console</span>.<span class="title function_">log</span>(e);</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">error</span>(<span class="string">&#x27;取消&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">          <span class="title function_">show_message</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">              <span class="variable language_">this</span>.<span class="title function_">axios</span>(<span class="string">&#x27;http://localhost:8000/show_message/?jwt=&#x27;</span>+<span class="variable language_">this</span>.<span class="property">user_id</span>).<span class="title function_">then</span>(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(res.<span class="property">data</span>)</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">if</span> (res.<span class="property">data</span>.<span class="property">code</span>==<span class="number">200</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                  <span class="variable language_">this</span>.<span class="title function_">openNotification</span>(res.<span class="property">data</span>.<span class="property">data</span>)</span></span><br><span class="line"><span class="language-javascript">                  <span class="variable language_">this</span>.<span class="property">number</span>=res.<span class="property">data</span>.<span class="property">number</span></span></span><br><span class="line"><span class="language-javascript">                  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">number</span>)</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">      &#125;)</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">         </span></span><br><span class="line"><span class="language-javascript">          <span class="title function_">openNotification</span>(<span class="params">msg</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.<span class="property">$notification</span>.<span class="title function_">open</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">              <span class="attr">message</span>: <span class="string">&#x27;Notification Title&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">              <span class="attr">description</span>:</span></span><br><span class="line"><span class="language-javascript">                msg,</span></span><br><span class="line"><span class="language-javascript">              <span class="attr">onClick</span>: <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Notification Clicked!&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">              &#125;,</span></span><br><span class="line"><span class="language-javascript">            &#125;);</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">//注册组件标签</span></span></span><br><span class="line"><span class="language-javascript">        <span class="attr">components</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">    </span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">created</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="title function_">show_message</span>()</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">mounted</span>:<span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">         </span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    </span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">var</span> ed2020 = <span class="string">&quot;2020&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">    </span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">var</span> sign = <span class="title function_">md5</span>(<span class="string">&#x27;price=500&amp;goodid=3,1&#x27;</span>+ed2020);</span></span><br><span class="line"><span class="language-javascript">    </span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">console</span>.<span class="title function_">log</span>(sign);</span></span><br><span class="line"><span class="language-javascript">          </span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">imgUrl</span> = <span class="string">&#x27;data:images/&#x27;</span> + <span class="variable language_">this</span>.<span class="property">suffic</span> +<span class="string">&#x27;;base64,&#x27;</span> + <span class="variable language_">this</span>.<span class="property">images</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">if</span>(<span class="string">&#x27;WebSocket&#x27;</span> <span class="keyword">in</span> <span class="variable language_">window</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;支持&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//生成websocket链接</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> ws = <span class="keyword">new</span> <span class="title class_">WebSocket</span>(<span class="string">&#x27;ws://localhost:8000/webscoketlink/?jwt=&#x27;</span>+<span class="variable language_">this</span>.<span class="property">user_id</span>)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//发送请求</span></span></span><br><span class="line"><span class="language-javascript">    ws.<span class="property">onopen</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      ws.<span class="title function_">send</span>(<span class="string">&#x27;test&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//发送消息</span></span></span><br><span class="line"><span class="language-javascript">    ws.<span class="property">onmessage</span> = <span class="keyword">function</span> (<span class="params">evt</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">//打印获取信息</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">var</span> receibved_msg = evt.<span class="property">data</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">alert</span>(receibved_msg)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// this.openNotification(receibved_msg)</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//捕获、断开连接</span></span></span><br><span class="line"><span class="language-javascript">    ws.<span class="property">onclose</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;链接已经关闭&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">      </span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    </span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    </span></span><br><span class="line"><span class="language-css">      <span class="selector-id">#components-layout-demo-custom-trigger</span> <span class="selector-class">.trigger</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">font-size</span>: <span class="number">18px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">line-height</span>: <span class="number">64px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">24px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">cursor</span>: pointer;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">transition</span>: color <span class="number">0.3s</span>;</span></span><br><span class="line"><span class="language-css">      &#125;</span></span><br><span class="line"><span class="language-css">    </span></span><br><span class="line"><span class="language-css">      <span class="selector-id">#components-layout-demo-custom-trigger</span> <span class="selector-class">.trigger</span><span class="selector-pseudo">:hover</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">color</span>: <span class="number">#1890ff</span>;</span></span><br><span class="line"><span class="language-css">      &#125;</span></span><br><span class="line"><span class="language-css">    </span></span><br><span class="line"><span class="language-css">      <span class="selector-id">#components-layout-demo-custom-trigger</span> <span class="selector-class">.logo</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">height</span>: <span class="number">32px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.2</span>);</span></span><br><span class="line"><span class="language-css">        <span class="attribute">margin</span>: <span class="number">16px</span>;</span></span><br><span class="line"><span class="language-css">    </span></span><br><span class="line"><span class="language-css">        <span class="attribute">color</span>:<span class="number">#ececf6</span> ;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">font-size</span>: <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">      &#125;</span></span><br><span class="line"><span class="language-css">    </span></span><br><span class="line"><span class="language-css">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">    </span><br></pre></td></tr></table></figure>

<h3 id="点击图标跳转到check-vue中完成消息已读和未读"><a href="#点击图标跳转到check-vue中完成消息已读和未读" class="headerlink" title="点击图标跳转到check.vue中完成消息已读和未读"></a>点击图标跳转到check.vue中完成消息已读和未读</h3><h4 id="在写点击事件的时候出现了一个错误，就是它找不到这个点击按钮这个属性，这里我直接使用的超链接跳转，可能是不想在标签上面浪费时间吧，现在正好是总结，我在谷歌搜到一些解释，没有定义在methods-里，不过这次应该不是这个问题，一开始以为是ant-desgin标签里没有这个元素-可就在刚才我强制刷新了一下页面，发现问题解决了。"><a href="#在写点击事件的时候出现了一个错误，就是它找不到这个点击按钮这个属性，这里我直接使用的超链接跳转，可能是不想在标签上面浪费时间吧，现在正好是总结，我在谷歌搜到一些解释，没有定义在methods-里，不过这次应该不是这个问题，一开始以为是ant-desgin标签里没有这个元素-可就在刚才我强制刷新了一下页面，发现问题解决了。" class="headerlink" title="在写点击事件的时候出现了一个错误，就是它找不到这个点击按钮这个属性，这里我直接使用的超链接跳转，可能是不想在标签上面浪费时间吧，现在正好是总结，我在谷歌搜到一些解释，没有定义在methods:{}里，不过这次应该不是这个问题，一开始以为是ant-desgin标签里没有这个元素,可就在刚才我强制刷新了一下页面，发现问题解决了。"></a>在写点击事件的时候出现了一个错误，就是它找不到这个点击按钮这个属性，这里我直接使用的超链接跳转，可能是不想在标签上面浪费时间吧，现在正好是总结，我在谷歌搜到一些解释，没有定义在methods:{}里，不过这次应该不是这个问题，一开始以为是ant-desgin标签里没有这个元素,可就在刚才我强制刷新了一下页面，发现问题解决了。</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a-layout</span> <span class="attr">id</span>=<span class="string">&quot;components-layout-demo-custom-trigger&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">a-layout-sider</span> <span class="attr">v-model</span>=<span class="string">&quot;collapsed&quot;</span> <span class="attr">:trigger</span>=<span class="string">&quot;null&quot;</span> <span class="attr">collapsible</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;logo&quot;</span> <span class="attr">style</span>=<span class="string">&quot;text-align:center;&quot;</span>&gt;</span> &#123;&#123;user&#125;&#125; <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">          <span class="tag">&lt;<span class="name">leftmenu</span>&gt;</span><span class="tag">&lt;/<span class="name">leftmenu</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">a-layout-sider</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">a-layout</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">a-layout-header</span> <span class="attr">style</span>=<span class="string">&quot;background: #fff; padding: 0&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a-icon</span></span></span><br><span class="line"><span class="tag">              <span class="attr">class</span>=<span class="string">&quot;trigger&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">:type</span>=<span class="string">&quot;collapsed ? &#x27;menu-unfold&#x27; : &#x27;menu-fold&#x27;&quot;</span></span></span><br><span class="line"><span class="tag">              @<span class="attr">click</span>=<span class="string">&quot;() =&gt; (collapsed = !collapsed)&quot;</span></span></span><br><span class="line"><span class="tag">            /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;float: right&quot;</span></span></span><br><span class="line"><span class="tag">              &gt;</span>&#123;&#123;user&#125;&#125;</span><br><span class="line">              <span class="tag">&lt;<span class="name">a-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;remove&quot;</span>&gt;</span>退出登录<span class="tag">&lt;/<span class="name">a-button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">photoheaders</span>&gt;</span><span class="tag">&lt;/<span class="name">photoheaders</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">a-layout-header</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">            <span class="tag">&lt;<span class="name">a-layout-content</span></span></span><br><span class="line"><span class="tag">            <span class="attr">:style</span>=<span class="string">&quot;&#123; margin: &#x27;24px 16px&#x27;, padding: &#x27;24px&#x27;, background: &#x27;#fff&#x27;, minHeight: &#x27;500px&#x27; &#125;&quot;</span>&gt;</span></span><br><span class="line">            </span><br><span class="line">            具体内容</span><br><span class="line">            <span class="tag">&lt;<span class="name">a-table</span> <span class="attr">bordered</span> <span class="attr">:data-source</span>=<span class="string">dataSource</span> <span class="attr">:columns</span>=<span class="string">&quot;columns&quot;</span> <span class="attr">:rowKey</span>=<span class="string">&#x27;record=&gt;record.id&#x27;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">template</span> <span class="attr">slot</span>=<span class="string">&quot;operation&quot;</span> <span class="attr">slot-scope</span>=<span class="string">&quot;text,record&quot;</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;Javascript:void(0)&quot;</span>  @<span class="attr">click</span>=<span class="string">&quot;()=&gt;read(record.id)&quot;</span>&gt;</span>已读<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">a-popconfirm</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">a-table</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">            <span class="tag">&lt;/<span class="name">a-layout-content</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">a-layout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">a-layout</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">  <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">   </span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  </span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">import</span> leftmenu <span class="keyword">from</span> <span class="string">&#x27;./leftmenu.vue&#x27;</span></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">import</span> photoheaders <span class="keyword">from</span> <span class="string">&#x27;./photoheaders&#x27;</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  </span></span><br><span class="line"><span class="language-javascript">  </span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    data () &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">img_url</span>:<span class="variable language_">this</span>.<span class="property">imgUrl</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">msg</span>: <span class="string">&quot;这是一个变量&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">collapsed</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">user</span>:<span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&quot;username&quot;</span>),</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">user_id</span>:<span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&quot;user_id&quot;</span>),</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">images</span>:<span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&quot;images&quot;</span>),</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">columns</span>:[</span></span><br><span class="line"><span class="language-javascript">          </span></span><br><span class="line"><span class="language-javascript">          &#123;<span class="attr">title</span>:<span class="string">&quot;编号&quot;</span>,<span class="attr">dataIndex</span>:<span class="string">&quot;id&quot;</span>&#125;,</span></span><br><span class="line"><span class="language-javascript">          &#123;<span class="attr">title</span>:<span class="string">&quot;消息&quot;</span>,<span class="attr">dataIndex</span>:<span class="string">&quot;message&quot;</span>,&#125;,</span></span><br><span class="line"><span class="language-javascript">          <span class="comment">//指定操作列</span></span></span><br><span class="line"><span class="language-javascript">          &#123;<span class="attr">title</span>:<span class="string">&quot;operation&quot;</span>,<span class="attr">dataIndex</span>:<span class="string">&quot;operation&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">scopedSlots</span>:&#123;<span class="attr">customRender</span>:<span class="string">&quot;operation&quot;</span>&#125;&#125;</span></span><br><span class="line"><span class="language-javascript">        ],</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">dataSource</span>:[]</span></span><br><span class="line"><span class="language-javascript">        </span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//注册组件标签</span></span></span><br><span class="line"><span class="language-javascript">    <span class="attr">components</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="string">&#x27;leftmenu&#x27;</span>:leftmenu,</span></span><br><span class="line"><span class="language-javascript">      <span class="string">&#x27;photoheaders&#x27;</span>:photoheaders</span></span><br><span class="line"><span class="language-javascript">  </span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="attr">methods</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">         <span class="comment">//退出登录</span></span></span><br><span class="line"><span class="language-javascript">    <span class="attr">remove</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">window</span>.<span class="property">localStorage</span>.<span class="title function_">clear</span>();</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">push</span>(<span class="string">&quot;/login&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">read</span>(<span class="params">mid</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">axios</span>.<span class="title function_">put</span>(<span class="string">&#x27;http://localhost:8000/message_info/?mid=&#x27;</span>+mid,&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">jwt</span>:<span class="variable language_">this</span>.<span class="property">user_id</span></span></span><br><span class="line"><span class="language-javascript">        &#125;).<span class="title function_">then</span>(<span class="function"><span class="params">resp</span>=&gt;</span>&#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">console</span>.<span class="title function_">log</span>(resp.<span class="property">data</span>)</span></span><br><span class="line"><span class="language-javascript">           <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">info</span>(resp.<span class="property">data</span>.<span class="property">message</span>)</span></span><br><span class="line"><span class="language-javascript">           <span class="variable language_">this</span>.<span class="title function_">get_message</span>()</span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript">         &#125;,</span></span><br><span class="line"><span class="language-javascript">         <span class="title function_">get_message</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">             <span class="variable language_">this</span>.<span class="property">axios</span>.<span class="title function_">get</span>(<span class="string">&#x27;http://localhost:8000/message_info/?jwt=&#x27;</span>+<span class="variable language_">this</span>.<span class="property">user_id</span>).<span class="title function_">then</span>(<span class="function"><span class="params">resp</span>=&gt;</span>&#123;</span></span><br><span class="line"><span class="language-javascript">                 <span class="variable language_">console</span>.<span class="title function_">log</span>(resp)</span></span><br><span class="line"><span class="language-javascript">                 <span class="variable language_">this</span>.<span class="property">dataSource</span> = resp.<span class="property">data</span>.<span class="property">data</span></span></span><br><span class="line"><span class="language-javascript">             &#125;)</span></span><br><span class="line"><span class="language-javascript">             </span></span><br><span class="line"><span class="language-javascript">         &#125;</span></span><br><span class="line"><span class="language-javascript">    </span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">created</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="title function_">get_message</span>()</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&#x27;number&#x27;</span>,<span class="number">0</span>)</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">  </span></span><br><span class="line"><span class="language-javascript">  </span></span><br><span class="line"><span class="language-javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">   </span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">  </span></span><br><span class="line"><span class="language-css">  <span class="selector-id">#components-layout-demo-custom-trigger</span> <span class="selector-class">.trigger</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">font-size</span>: <span class="number">18px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">line-height</span>: <span class="number">64px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">24px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">cursor</span>: pointer;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">transition</span>: color <span class="number">0.3s</span>;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css">  </span></span><br><span class="line"><span class="language-css">  <span class="selector-id">#components-layout-demo-custom-trigger</span> <span class="selector-class">.trigger</span><span class="selector-pseudo">:hover</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">color</span>: <span class="number">#1890ff</span>;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css">  </span></span><br><span class="line"><span class="language-css">  <span class="selector-id">#components-layout-demo-custom-trigger</span> <span class="selector-class">.logo</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">height</span>: <span class="number">32px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.2</span>);</span></span><br><span class="line"><span class="language-css">    <span class="attribute">margin</span>: <span class="number">16px</span>;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css">  </span></span><br><span class="line"><span class="language-css">  </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="后端django"><a href="#后端django" class="headerlink" title="后端django"></a>后端django</h3><h4 id="在审批流程中，审批失败或者成功之后，将数据存入redis。"><a href="#在审批流程中，审批失败或者成功之后，将数据存入redis。" class="headerlink" title="在审批流程中，审批失败或者成功之后，将数据存入redis。"></a>在审批流程中，审批失败或者成功之后，将数据存入redis。</h4><h4 id="这里为什么要使用redis-不使用mysql"><a href="#这里为什么要使用redis-不使用mysql" class="headerlink" title="这里为什么要使用redis,不使用mysql?"></a>这里为什么要使用redis,不使用mysql?</h4><h5 id="字符串存入redis会覆盖之前的数据-其实像短消息这类内容不太需要存mysql-但是像微信聊天记录这种可能需要保存很久的内容，就需要存到mysql了。还有和淘宝京东之类的购物网站的客服聊天记录-通常不需要存太久，用户就会舍弃掉，所以会存在redis。"><a href="#字符串存入redis会覆盖之前的数据-其实像短消息这类内容不太需要存mysql-但是像微信聊天记录这种可能需要保存很久的内容，就需要存到mysql了。还有和淘宝京东之类的购物网站的客服聊天记录-通常不需要存太久，用户就会舍弃掉，所以会存在redis。" class="headerlink" title="字符串存入redis会覆盖之前的数据,其实像短消息这类内容不太需要存mysql,但是像微信聊天记录这种可能需要保存很久的内容，就需要存到mysql了。还有和淘宝京东之类的购物网站的客服聊天记录,通常不需要存太久，用户就会舍弃掉，所以会存在redis。"></a>字符串存入redis会覆盖之前的数据,其实像短消息这类内容不太需要存mysql,但是像微信聊天记录这种可能需要保存很久的内容，就需要存到mysql了。还有和淘宝京东之类的购物网站的客服聊天记录,通常不需要存太久，用户就会舍弃掉，所以会存在redis。</h5><h5 id="比mysql成本低。"><a href="#比mysql成本低。" class="headerlink" title="比mysql成本低。"></a>比mysql成本低。</h5><h5 id="购物车信息怎么存"><a href="#购物车信息怎么存" class="headerlink" title="购物车信息怎么存?"></a>购物车信息怎么存?</h5><h5 id="购物车还可以存localstorage-手机端也有localstorage，在web端做一些操作，先读取redis-然后覆盖数据，使用localstorage同步。所以我们学会灵活运用。"><a href="#购物车还可以存localstorage-手机端也有localstorage，在web端做一些操作，先读取redis-然后覆盖数据，使用localstorage同步。所以我们学会灵活运用。" class="headerlink" title="购物车还可以存localstorage,手机端也有localstorage，在web端做一些操作，先读取redis,然后覆盖数据，使用localstorage同步。所以我们学会灵活运用。"></a>购物车还可以存localstorage,手机端也有localstorage，在web端做一些操作，先读取redis,然后覆盖数据，使用localstorage同步。所以我们学会灵活运用。</h5><h5 id="为什么使用集合存储？"><a href="#为什么使用集合存储？" class="headerlink" title="为什么使用集合存储？"></a>为什么使用集合存储？</h5><h5 id="集合的特性是去重，比如发年终奖时，可以分析一个人请假的多少的排行榜。"><a href="#集合的特性是去重，比如发年终奖时，可以分析一个人请假的多少的排行榜。" class="headerlink" title="集合的特性是去重，比如发年终奖时，可以分析一个人请假的多少的排行榜。"></a>集合的特性是去重，比如发年终奖时，可以分析一个人请假的多少的排行榜。</h5><p>审批流程部分代码:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">put</span>(<span class="params">self, request</span>):</span><br><span class="line">      tid = request.POST.get(<span class="string">&#x27;tid&#x27;</span>)</span><br><span class="line">      wid = request.POST.get(<span class="string">&#x27;wid&#x27;</span>)</span><br><span class="line">      work_obj = WorkOrder.objects.get(pk=wid)</span><br><span class="line">      user_obj = User.objects.get(pk=work_obj.user)</span><br><span class="line">      typeobj = WorkType.objects.get(pk=work_obj.work_type)</span><br><span class="line">      state = request.POST.get(<span class="string">&quot;state&quot;</span>)</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&#x27;----------------------------state&#x27;</span>, state)</span><br><span class="line">      refuse = request.POST.get(<span class="string">&quot;refuse&quot;</span>)</span><br><span class="line">      query_set = Task.objects.get(pk=tid)</span><br><span class="line">      <span class="built_in">print</span>(wid)</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&#x27;``````````````````````````` task_id&#x27;</span>, query_set.<span class="built_in">id</span>)</span><br><span class="line">      <span class="keyword">try</span>:</span><br><span class="line">          <span class="keyword">if</span> state == <span class="string">&#x27;审批通过&#x27;</span>:</span><br><span class="line">              <span class="built_in">list</span> = json.loads(query_set.next_id)</span><br><span class="line">              <span class="built_in">next</span> = query_set.uid</span><br><span class="line">              query_set.state = state</span><br><span class="line">              query_set.uid = <span class="built_in">int</span>(<span class="built_in">next</span> + <span class="number">1</span>)</span><br><span class="line">              query_set.work_id = <span class="built_in">int</span>(wid)</span><br><span class="line">              query_set.next_id = json.dumps(<span class="built_in">list</span>)</span><br><span class="line">              query_set.refuse = refuse</span><br><span class="line">              query_set.save()</span><br><span class="line">              text = <span class="string">&#x27;尊敬的&#123;&#125;,您的&#123;&#125;已被批准&#x27;</span>.<span class="built_in">format</span>(user_obj.username, typeobj.typename)</span><br><span class="line">              <span class="comment"># dingtalk(text)</span></span><br><span class="line">              <span class="keyword">if</span> user_obj.<span class="built_in">id</span> <span class="keyword">in</span> clients:</span><br><span class="line">                  <span class="built_in">print</span>(<span class="string">&#x27;ok&#x27;</span>)</span><br><span class="line">                  clients[user_obj.<span class="built_in">id</span>].send(text.encode(<span class="string">&quot;utf-8&quot;</span>))</span><br><span class="line">                  redis.hset(user_obj.<span class="built_in">id</span>, query_set.<span class="built_in">id</span>, text)</span><br><span class="line">                  redis.hincrby(user_obj.<span class="built_in">id</span>, <span class="string">&#x27;number&#x27;</span>, <span class="number">1</span>)</span><br><span class="line">              <span class="keyword">else</span>:</span><br><span class="line">                  <span class="built_in">print</span>(<span class="string">&#x27;存入redis&#x27;</span>)</span><br><span class="line">                  redis.hset(user_obj.<span class="built_in">id</span>, query_set.<span class="built_in">id</span>, text)  <span class="comment"># 以哈希类型往redis存入用户id,task_id,和反馈内容</span></span><br><span class="line">                  redis.hincrby(user_obj.<span class="built_in">id</span>, <span class="string">&#x27;number&#x27;</span>, <span class="number">1</span>)</span><br><span class="line">                  <span class="comment"># 字符串存redis会覆盖 dlete是物理删除 消息不太需要存在mysql 微信聊天记录需要存 客服聊天内容不需要存  购物车的数据也不用存 （存redis）</span></span><br><span class="line">                  <span class="comment"># 比mysql成本低，购物车存localstorage,手机端也有localstorage,在web端做一些操作，先读redis,覆盖，用localstorage同步</span></span><br><span class="line">                  <span class="comment"># 集合的特性是去重 分析一个人请假的多少 排行榜 用socketset 字符串 哈希 集合</span></span><br><span class="line">              <span class="keyword">return</span> Response(&#123;<span class="string">&quot;code&quot;</span>: <span class="number">200</span>, <span class="string">&quot;massage&quot;</span>: <span class="string">&quot;操作成功&quot;</span>&#125;)</span><br><span class="line">          <span class="keyword">else</span>:</span><br><span class="line">              query_set.state = state</span><br><span class="line">              query_set.refuse = refuse</span><br><span class="line">              query_set.save()</span><br><span class="line">              work_obj.status = <span class="string">&#x27;审核拒绝&#x27;</span></span><br><span class="line">              work_obj.save()</span><br><span class="line">              text = <span class="string">&#x27;尊敬的&#123;&#125;,您的&#123;&#125;已被拒绝,原因为&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(user_obj.username, typeobj.typename, query_set.refuse)</span><br><span class="line">              <span class="comment"># dingtalk(text)</span></span><br><span class="line">              <span class="built_in">print</span>(<span class="string">&#x27;``````````````````````````clients&#x27;</span>, clients)</span><br><span class="line">              <span class="keyword">if</span> user_obj.<span class="built_in">id</span> <span class="keyword">in</span> clients:</span><br><span class="line">                  <span class="built_in">print</span>(<span class="string">&#x27;ok&#x27;</span>)</span><br><span class="line">                  clients[user_obj.<span class="built_in">id</span>].send(text.encode(<span class="string">&quot;utf-8&quot;</span>))</span><br><span class="line">                  redis.hincrby(user_obj.<span class="built_in">id</span>, <span class="string">&#x27;number&#x27;</span>, <span class="number">1</span>)</span><br><span class="line">              <span class="keyword">else</span>:</span><br><span class="line">                  <span class="built_in">print</span>(<span class="string">&#x27;`````````````````````正在存入redis&#x27;</span>)</span><br><span class="line">                  redis.hset(user_obj.<span class="built_in">id</span>, query_set.<span class="built_in">id</span>, text)</span><br><span class="line">                  redis.hincrby(user_obj.<span class="built_in">id</span>, <span class="string">&#x27;number&#x27;</span>, <span class="number">1</span>)</span><br><span class="line">              <span class="keyword">return</span> Response(&#123;<span class="string">&quot;code&quot;</span>: <span class="number">200</span>, <span class="string">&quot;massage&quot;</span>: <span class="string">&quot;操作成功&quot;</span>&#125;)</span><br><span class="line">      <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">          <span class="keyword">if</span> <span class="built_in">str</span>(e) == <span class="string">&#x27;list index out of range&#x27;</span>:</span><br><span class="line">              work_obj = WorkOrder.objects.get(pk=wid)</span><br><span class="line">              work_obj.status = <span class="string">&#x27;审核完成&#x27;</span></span><br><span class="line">              work_obj.save()</span><br><span class="line">              text = <span class="string">&#x27;尊敬的&#123;&#125;,您的&#123;&#125;已被批准&#x27;</span>.<span class="built_in">format</span>(user_obj.username, typeobj.typename)</span><br><span class="line">              <span class="comment"># dingtalk(text)</span></span><br><span class="line">              <span class="keyword">if</span> user_obj.<span class="built_in">id</span> <span class="keyword">in</span> clients:</span><br><span class="line">                  <span class="built_in">print</span>(<span class="string">&#x27;ok&#x27;</span>)</span><br><span class="line">                  clients[user_obj.<span class="built_in">id</span>].send(text.encode(<span class="string">&quot;utf-8&quot;</span>))</span><br><span class="line">                  redis.hincrby(user_obj.<span class="built_in">id</span>, <span class="string">&#x27;number&#x27;</span>, <span class="number">1</span>)</span><br><span class="line">              <span class="keyword">else</span>:</span><br><span class="line">                  <span class="built_in">print</span>(<span class="string">&#x27;存入redis&#x27;</span>)</span><br><span class="line">                  redis.hset(user_obj.<span class="built_in">id</span>, query_set.<span class="built_in">id</span>, text)</span><br><span class="line">                  redis.hincrby(user_obj.<span class="built_in">id</span>, <span class="string">&#x27;number&#x27;</span>, <span class="number">1</span>)</span><br><span class="line">              <span class="keyword">return</span> Response(&#123;<span class="string">&quot;code&quot;</span>: <span class="number">200</span>, <span class="string">&quot;massage&quot;</span>: <span class="string">&quot;审批完成&quot;</span>&#125;)</span><br><span class="line">          <span class="keyword">return</span> Response(&#123;<span class="string">&quot;code&quot;</span>: <span class="number">500</span>, <span class="string">&quot;massage&quot;</span>: <span class="string">&quot;操作失败&quot;</span>&#125;)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="消息模块"><a href="#消息模块" class="headerlink" title="消息模块"></a>消息模块</h3><h5 id="websocket有一个送达率的问题，这也是目前一个世界性的难题，我们每一次消息推送都会有一个送达数，当一次消息推送产生的时候，目标用户中会有一些当时在线和一些不在线的。系统会根据用户的状态立即向在线的用户进行推送，-当时不在线的用户系统会为其保存离线消息，消息有效期之内用户恢复网络后，系统会将离线消息发送到用户客户端。"><a href="#websocket有一个送达率的问题，这也是目前一个世界性的难题，我们每一次消息推送都会有一个送达数，当一次消息推送产生的时候，目标用户中会有一些当时在线和一些不在线的。系统会根据用户的状态立即向在线的用户进行推送，-当时不在线的用户系统会为其保存离线消息，消息有效期之内用户恢复网络后，系统会将离线消息发送到用户客户端。" class="headerlink" title="websocket有一个送达率的问题，这也是目前一个世界性的难题，我们每一次消息推送都会有一个送达数，当一次消息推送产生的时候，目标用户中会有一些当时在线和一些不在线的。系统会根据用户的状态立即向在线的用户进行推送， 当时不在线的用户系统会为其保存离线消息，消息有效期之内用户恢复网络后，系统会将离线消息发送到用户客户端。"></a>websocket有一个送达率的问题，这也是目前一个世界性的难题，我们每一次<strong>消息推送</strong>都会有一个送达数，当一次消息推送产生的时候，目标用户中会有一些当时在线和一些不在线的。系统会根据用户的状态立即向在线的用户进行推送， 当时不在线的用户系统会为其保存离线消息，消息有效期之内用户恢复网络后，系统会将离线消息发送到用户客户端。</h5><h5 id="附上消息模块代码"><a href="#附上消息模块代码" class="headerlink" title="附上消息模块代码"></a>附上消息模块代码</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line">clients = &#123;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@accept_websocket</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">webscoketlink</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="keyword">if</span> request.is_websocket():</span><br><span class="line">        token = request.GET.get(<span class="string">&#x27;jwt&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># username = request.GET.get(&#x27;username&#x27;)</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># print(&#x27;``````````````````````````````````````username&#x27;,username)</span></span><br><span class="line"></span><br><span class="line">        userid = jwt.decode(token, settings.SECRET_KEY, algorithms=[<span class="string">&#x27;HS256&#x27;</span>]).get(<span class="string">&#x27;user_id&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;``````````````````````````````````````userid&#x27;</span>, userid)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line"></span><br><span class="line">            message = request.websocket.wait()</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> message:</span><br><span class="line">                clients.pop(userid)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;webscoket链接成功&#x27;</span> + <span class="built_in">str</span>(message))  <span class="comment"># 也可以用format</span></span><br><span class="line"></span><br><span class="line">                clients[userid] = request.websocket</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    res = redis  <span class="comment"># redis在setting中</span></span><br><span class="line">                    <span class="keyword">if</span> res.sinter(userid):</span><br><span class="line">                        <span class="keyword">for</span> msg <span class="keyword">in</span> res.sinter(userid):</span><br><span class="line">                            message = (msg.decode().split(<span class="string">&#x27;#&#x27;</span>))[<span class="number">0</span>]</span><br><span class="line">                            <span class="built_in">print</span>(message)</span><br><span class="line">                            request.websocket.send(message.encoe(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">                            time.sleep(<span class="number">2</span>)</span><br><span class="line">                        res.delete(userid)</span><br><span class="line">                <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                    <span class="built_in">print</span>(e)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">count = &#123;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 发送消息数量</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">show_message</span>(<span class="title class_ inherited__">APIView</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, request</span>):</span><br><span class="line">        token = request.GET.get(<span class="string">&#x27;jwt&#x27;</span>)</span><br><span class="line">        uid = jwt.decode(token, settings.SECRET_KEY,</span><br><span class="line">                         algorithms=[<span class="string">&#x27;HS256&#x27;</span>]).get(<span class="string">&#x27;user_id&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">str</span>(uid) <span class="keyword">in</span> count:</span><br><span class="line">            <span class="keyword">return</span> Response(&#123;<span class="string">&quot;code&quot;</span>: <span class="number">400</span>, <span class="string">&quot;message&quot;</span>: <span class="string">&quot;无数据&quot;</span>&#125;)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> redis.hgetall(<span class="built_in">str</span>(uid)):</span><br><span class="line">                number = redis.hget(<span class="built_in">str</span>(uid), <span class="string">&#x27;number&#x27;</span>)</span><br><span class="line">                count[<span class="built_in">str</span>(uid)] = <span class="string">&#x27;read&#x27;</span></span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">int</span>(number) &gt; <span class="number">0</span>:</span><br><span class="line">                    <span class="keyword">return</span> Response(&#123;<span class="string">&quot;code&quot;</span>: <span class="number">200</span>, <span class="string">&quot;data&quot;</span>: <span class="string">f&#x27;你有<span class="subst">&#123;number.decode()&#125;</span>新消息&#x27;</span>, <span class="string">&#x27;number&#x27;</span>: number.decode()&#125;)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> Response(&#123;<span class="string">&quot;code&quot;</span>: <span class="number">400</span>, <span class="string">&quot;message&quot;</span>: <span class="string">&quot;无数据&quot;</span>&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">message_info</span>(<span class="title class_ inherited__">APIView</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, request</span>):</span><br><span class="line">        mlist = []</span><br><span class="line">        token = request.GET.get(<span class="string">&#x27;jwt&#x27;</span>)</span><br><span class="line">        uid = jwt.decode(token, settings.SECRET_KEY,</span><br><span class="line">                         algorithms=[<span class="string">&#x27;HS256&#x27;</span>]).get(<span class="string">&#x27;user_id&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(uid)</span><br><span class="line">        <span class="keyword">if</span> redis.hgetall(<span class="built_in">str</span>(uid)):</span><br><span class="line">            res = redis.hgetall(<span class="built_in">str</span>(uid))</span><br><span class="line">            <span class="built_in">print</span>(res)</span><br><span class="line">            <span class="keyword">for</span> key, value <span class="keyword">in</span> res.items():</span><br><span class="line">                <span class="built_in">dict</span> = &#123;&#125;</span><br><span class="line">                <span class="keyword">if</span> key.decode() != <span class="string">&#x27;number&#x27;</span>:</span><br><span class="line">                    <span class="built_in">dict</span>[<span class="string">&quot;id&quot;</span>] = <span class="built_in">str</span>(key.decode())</span><br><span class="line">                    <span class="built_in">dict</span>[<span class="string">&quot;message&quot;</span>] = (value.decode()).encode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">                    mlist.append(<span class="built_in">dict</span>)</span><br><span class="line">            <span class="keyword">return</span> Response(&#123;<span class="string">&#x27;code&#x27;</span>: <span class="number">200</span>, <span class="string">&#x27;data&#x27;</span>: mlist&#125;)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> Response(&#123;<span class="string">&#x27;code&#x27;</span>: <span class="number">200</span>, <span class="string">&#x27;message&#x27;</span>: <span class="string">&quot;暂无消息&quot;</span>&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">put</span>(<span class="params">self, request</span>):</span><br><span class="line">        mid = request.GET.get(<span class="string">&#x27;mid&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;`````````````````````mid&#x27;</span>, mid)</span><br><span class="line">        token = request.data.get(<span class="string">&#x27;jwt&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;`````````````````````token&#x27;</span>, token)</span><br><span class="line">        uid = jwt.decode(token, settings.SECRET_KEY,</span><br><span class="line">                         algorithms=[<span class="string">&#x27;HS256&#x27;</span>]).get(<span class="string">&#x27;user_id&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(uid)</span><br><span class="line">        redis.hdel(<span class="built_in">str</span>(uid), <span class="built_in">str</span>(mid))</span><br><span class="line">        redis.hincrby(<span class="built_in">str</span>(uid), <span class="string">&#x27;number&#x27;</span>, <span class="string">&#x27;-1&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> Response(&#123;<span class="string">&quot;code&quot;</span>: <span class="number">200</span>, <span class="string">&quot;message&quot;</span>: <span class="string">&quot;操作成功&quot;</span>&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 推送消息</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sendmessage</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="comment"># 获取消息</span></span><br><span class="line">    msg = request.GET.get(<span class="string">&quot;msg&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> client <span class="keyword">in</span> clients:</span><br><span class="line">        clients[client].send(msg.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(&#123;<span class="string">&#x27;OK&#x27;</span>&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>











</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://example.com">车 川</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章連結: </span><span class="post-copyright-info"><a href="http://example.com/2020/11/19/%E6%B6%88%E6%81%AF%E7%9B%92%E5%AD%90/">http://example.com/2020/11/19/%E6%B6%88%E6%81%AF%E7%9B%92%E5%AD%90/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版權聲明: </span><span class="post-copyright-info">本部落格所有文章除特別聲明外，均採用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 許可協議。轉載請註明來自 <a href="http://example.com" target="_blank">被梦的个人博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E6%99%BA%E8%83%BD%E9%AB%98%E5%B9%B6%E5%8F%91%E5%AE%A1%E6%89%B9%E6%B5%81%E7%B3%BB%E7%BB%9F/">智能高并发审批流系统</a></div><div class="post_share"><div class="social-share" data-image="https://jsd.012700.xyz/gh/jerryc127/butterfly_cdn@2.1.0/top_img/index.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>贊助</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/wechat.jpg" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2020/11/19/%E5%88%9B%E5%BB%BA%E9%92%89%E9%92%89%E6%B6%88%E6%81%AF%E5%BE%85%E5%8A%9E/" title="创建钉钉消息待办"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://jsd.012700.xyz/gh/jerryc127/butterfly_cdn@2.1.0/top_img/index.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">创建钉钉消息待办</div></div></a></div><div class="next-post pull-right"><a href="/2020/11/19/%E5%8F%88%E6%8B%8D%E4%BA%91%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6/" title="又拍云上传文件"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://jsd.012700.xyz/gh/jerryc127/butterfly_cdn@2.1.0/top_img/index.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">又拍云上传文件</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相關推薦</span></div><div class="relatedPosts-list"><div><a href="/2020/11/19/ABAC%E6%9D%83%E9%99%90%E6%A8%A1%E5%9E%8B/" title="ABAC权限模型"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://jsd.012700.xyz/gh/jerryc127/butterfly_cdn@2.1.0/top_img/index.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-11-19</div><div class="title">ABAC权限模型</div></div></a></div><div><a href="/2019/11/19/RBAC%E6%9D%83%E9%99%90%E6%A8%A1%E5%9E%8B/" title="RBAC权限模型"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://jsd.012700.xyz/gh/jerryc127/butterfly_cdn@2.1.0/top_img/index.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2019-11-19</div><div class="title">RBAC权限模型</div></div></a></div><div><a href="/2020/11/19/base64%E5%9B%BE%E7%89%87%E5%B1%95%E7%A4%BA/" title="base64图片展示"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://jsd.012700.xyz/gh/jerryc127/butterfly_cdn@2.1.0/top_img/index.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-11-19</div><div class="title">base64图片展示</div></div></a></div><div><a href="/2020/11/19/ip%E5%B0%81%E7%A6%81/" title="ip封禁"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://jsd.012700.xyz/gh/jerryc127/butterfly_cdn@2.1.0/top_img/index.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-11-19</div><div class="title">ip封禁</div></div></a></div><div><a href="/2020/10/19/websocket%E5%AE%9E%E6%97%B6%E6%8E%A8%E9%80%81%E9%80%9A%E7%9F%A5/" title="websocket实时推送通知"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://jsd.012700.xyz/gh/jerryc127/butterfly_cdn@2.1.0/top_img/index.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-10-19</div><div class="title">websocket实时推送通知</div></div></a></div><div><a href="/2020/11/16/%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85%E6%A8%A1%E5%BC%8F%E4%B8%8E%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F/" title="发布订阅模式与观察者模式"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://jsd.012700.xyz/gh/jerryc127/butterfly_cdn@2.1.0/top_img/index.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-11-16</div><div class="title">发布订阅模式与观察者模式</div></div></a></div></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 評論</span></div></div><div class="comment-wrap"><div><div id="waline-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://i.postimg.cc/kMkqZ7ym/Wechat-IMG95.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">车 川</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">54</div></a><a href="/tags/"><div class="headline">標籤</div><div class="length-num">15</div></a><a href="/categories/"><div class="headline">分類</div><div class="length-num">14</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/xxxxx" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:xxxxxx@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目錄</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#redis%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="toc-number">1.</span> <span class="toc-text">redis的基本操作</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96"><span class="toc-number">2.</span> <span class="toc-text">获取</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#hash%E7%B1%BB%E5%9E%8B"><span class="toc-number">3.</span> <span class="toc-text">hash类型</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A2%9E%E5%8A%A0%E3%80%81%E4%BF%AE%E6%94%B9"><span class="toc-number">3.1.</span> <span class="toc-text">增加、修改</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96-1"><span class="toc-number">3.2.</span> <span class="toc-text">获取</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A0%E9%99%A4"><span class="toc-number">3.3.</span> <span class="toc-text">删除</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#list%E7%B1%BB%E5%9E%8B"><span class="toc-number">4.</span> <span class="toc-text">list类型</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A2%9E%E5%8A%A0"><span class="toc-number">4.1.</span> <span class="toc-text">增加</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96-2"><span class="toc-number">4.2.</span> <span class="toc-text">获取</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E6%8C%87%E5%AE%9A%E7%B4%A2%E5%BC%95%E4%BD%8D%E7%BD%AE%E7%9A%84%E5%85%83%E7%B4%A0%E5%80%BC"><span class="toc-number">4.3.</span> <span class="toc-text">设置指定索引位置的元素值</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A0%E9%99%A4-1"><span class="toc-number">4.4.</span> <span class="toc-text">删除</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#set%E7%B1%BB%E5%9E%8B"><span class="toc-number">5.</span> <span class="toc-text">set类型</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A2%9E%E5%8A%A0-1"><span class="toc-number">5.1.</span> <span class="toc-text">增加</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96-3"><span class="toc-number">5.2.</span> <span class="toc-text">获取</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A0%E9%99%A4-2"><span class="toc-number">5.3.</span> <span class="toc-text">删除</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B6%88%E6%81%AF%E7%9B%92%E5%AD%90"><span class="toc-number">6.</span> <span class="toc-text">消息盒子</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9C%A8%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BB%84%E4%BB%B6%E4%B8%AD%E5%8A%A0%E5%85%A5%E5%BE%BD%E7%AB%A0%E5%9B%BE%E6%A0%87-%E7%94%A8%E4%BA%8E%E6%B6%88%E6%81%AF%E6%8F%90%E7%A4%BA%EF%BC%8C%E4%BD%BF%E7%94%A8a-badge%E6%A0%87%E7%AD%BE%E3%80%82"><span class="toc-number">6.1.</span> <span class="toc-text">在自定义组件中加入徽章图标,用于消息提示，使用a-badge标签。</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%88%E6%9E%9C%E5%A6%82%E4%B8%8B"><span class="toc-number">6.1.1.</span> <span class="toc-text">效果如下</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%88%91%E4%BB%AC%E9%9C%80%E8%A6%81%E5%8F%B3%E4%B8%8A%E8%A7%92%E7%9A%84%E6%95%B0%E5%AD%97-%E9%A6%96%E5%85%88%E7%BB%91%E5%AE%9A%E4%B8%80%E4%B8%AAnumber-%E8%BF%99%E4%B8%AAnumber%E5%9C%A8%E5%90%8E%E7%AB%AF%E8%8E%B7%E5%8F%96%E3%80%82"><span class="toc-number">6.1.2.</span> <span class="toc-text">我们需要右上角的数字,首先绑定一个number,这个number在后端获取。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%82%B9%E5%87%BB%E5%9B%BE%E6%A0%87%E8%B7%B3%E8%BD%AC%E5%88%B0check-vue%E4%B8%AD%E5%AE%8C%E6%88%90%E6%B6%88%E6%81%AF%E5%B7%B2%E8%AF%BB%E5%92%8C%E6%9C%AA%E8%AF%BB"><span class="toc-number">6.1.3.</span> <span class="toc-text">点击图标跳转到check.vue中完成消息已读和未读</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%A8%E5%86%99%E7%82%B9%E5%87%BB%E4%BA%8B%E4%BB%B6%E7%9A%84%E6%97%B6%E5%80%99%E5%87%BA%E7%8E%B0%E4%BA%86%E4%B8%80%E4%B8%AA%E9%94%99%E8%AF%AF%EF%BC%8C%E5%B0%B1%E6%98%AF%E5%AE%83%E6%89%BE%E4%B8%8D%E5%88%B0%E8%BF%99%E4%B8%AA%E7%82%B9%E5%87%BB%E6%8C%89%E9%92%AE%E8%BF%99%E4%B8%AA%E5%B1%9E%E6%80%A7%EF%BC%8C%E8%BF%99%E9%87%8C%E6%88%91%E7%9B%B4%E6%8E%A5%E4%BD%BF%E7%94%A8%E7%9A%84%E8%B6%85%E9%93%BE%E6%8E%A5%E8%B7%B3%E8%BD%AC%EF%BC%8C%E5%8F%AF%E8%83%BD%E6%98%AF%E4%B8%8D%E6%83%B3%E5%9C%A8%E6%A0%87%E7%AD%BE%E4%B8%8A%E9%9D%A2%E6%B5%AA%E8%B4%B9%E6%97%B6%E9%97%B4%E5%90%A7%EF%BC%8C%E7%8E%B0%E5%9C%A8%E6%AD%A3%E5%A5%BD%E6%98%AF%E6%80%BB%E7%BB%93%EF%BC%8C%E6%88%91%E5%9C%A8%E8%B0%B7%E6%AD%8C%E6%90%9C%E5%88%B0%E4%B8%80%E4%BA%9B%E8%A7%A3%E9%87%8A%EF%BC%8C%E6%B2%A1%E6%9C%89%E5%AE%9A%E4%B9%89%E5%9C%A8methods-%E9%87%8C%EF%BC%8C%E4%B8%8D%E8%BF%87%E8%BF%99%E6%AC%A1%E5%BA%94%E8%AF%A5%E4%B8%8D%E6%98%AF%E8%BF%99%E4%B8%AA%E9%97%AE%E9%A2%98%EF%BC%8C%E4%B8%80%E5%BC%80%E5%A7%8B%E4%BB%A5%E4%B8%BA%E6%98%AFant-desgin%E6%A0%87%E7%AD%BE%E9%87%8C%E6%B2%A1%E6%9C%89%E8%BF%99%E4%B8%AA%E5%85%83%E7%B4%A0-%E5%8F%AF%E5%B0%B1%E5%9C%A8%E5%88%9A%E6%89%8D%E6%88%91%E5%BC%BA%E5%88%B6%E5%88%B7%E6%96%B0%E4%BA%86%E4%B8%80%E4%B8%8B%E9%A1%B5%E9%9D%A2%EF%BC%8C%E5%8F%91%E7%8E%B0%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3%E4%BA%86%E3%80%82"><span class="toc-number">6.1.3.1.</span> <span class="toc-text">在写点击事件的时候出现了一个错误，就是它找不到这个点击按钮这个属性，这里我直接使用的超链接跳转，可能是不想在标签上面浪费时间吧，现在正好是总结，我在谷歌搜到一些解释，没有定义在methods:{}里，不过这次应该不是这个问题，一开始以为是ant-desgin标签里没有这个元素,可就在刚才我强制刷新了一下页面，发现问题解决了。</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8E%E7%AB%AFdjango"><span class="toc-number">6.1.4.</span> <span class="toc-text">后端django</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%A8%E5%AE%A1%E6%89%B9%E6%B5%81%E7%A8%8B%E4%B8%AD%EF%BC%8C%E5%AE%A1%E6%89%B9%E5%A4%B1%E8%B4%A5%E6%88%96%E8%80%85%E6%88%90%E5%8A%9F%E4%B9%8B%E5%90%8E%EF%BC%8C%E5%B0%86%E6%95%B0%E6%8D%AE%E5%AD%98%E5%85%A5redis%E3%80%82"><span class="toc-number">6.1.4.1.</span> <span class="toc-text">在审批流程中，审批失败或者成功之后，将数据存入redis。</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%99%E9%87%8C%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E4%BD%BF%E7%94%A8redis-%E4%B8%8D%E4%BD%BF%E7%94%A8mysql"><span class="toc-number">6.1.4.2.</span> <span class="toc-text">这里为什么要使用redis,不使用mysql?</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%AD%98%E5%85%A5redis%E4%BC%9A%E8%A6%86%E7%9B%96%E4%B9%8B%E5%89%8D%E7%9A%84%E6%95%B0%E6%8D%AE-%E5%85%B6%E5%AE%9E%E5%83%8F%E7%9F%AD%E6%B6%88%E6%81%AF%E8%BF%99%E7%B1%BB%E5%86%85%E5%AE%B9%E4%B8%8D%E5%A4%AA%E9%9C%80%E8%A6%81%E5%AD%98mysql-%E4%BD%86%E6%98%AF%E5%83%8F%E5%BE%AE%E4%BF%A1%E8%81%8A%E5%A4%A9%E8%AE%B0%E5%BD%95%E8%BF%99%E7%A7%8D%E5%8F%AF%E8%83%BD%E9%9C%80%E8%A6%81%E4%BF%9D%E5%AD%98%E5%BE%88%E4%B9%85%E7%9A%84%E5%86%85%E5%AE%B9%EF%BC%8C%E5%B0%B1%E9%9C%80%E8%A6%81%E5%AD%98%E5%88%B0mysql%E4%BA%86%E3%80%82%E8%BF%98%E6%9C%89%E5%92%8C%E6%B7%98%E5%AE%9D%E4%BA%AC%E4%B8%9C%E4%B9%8B%E7%B1%BB%E7%9A%84%E8%B4%AD%E7%89%A9%E7%BD%91%E7%AB%99%E7%9A%84%E5%AE%A2%E6%9C%8D%E8%81%8A%E5%A4%A9%E8%AE%B0%E5%BD%95-%E9%80%9A%E5%B8%B8%E4%B8%8D%E9%9C%80%E8%A6%81%E5%AD%98%E5%A4%AA%E4%B9%85%EF%BC%8C%E7%94%A8%E6%88%B7%E5%B0%B1%E4%BC%9A%E8%88%8D%E5%BC%83%E6%8E%89%EF%BC%8C%E6%89%80%E4%BB%A5%E4%BC%9A%E5%AD%98%E5%9C%A8redis%E3%80%82"><span class="toc-number">6.1.4.2.1.</span> <span class="toc-text">字符串存入redis会覆盖之前的数据,其实像短消息这类内容不太需要存mysql,但是像微信聊天记录这种可能需要保存很久的内容，就需要存到mysql了。还有和淘宝京东之类的购物网站的客服聊天记录,通常不需要存太久，用户就会舍弃掉，所以会存在redis。</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%AF%94mysql%E6%88%90%E6%9C%AC%E4%BD%8E%E3%80%82"><span class="toc-number">6.1.4.2.2.</span> <span class="toc-text">比mysql成本低。</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%B4%AD%E7%89%A9%E8%BD%A6%E4%BF%A1%E6%81%AF%E6%80%8E%E4%B9%88%E5%AD%98"><span class="toc-number">6.1.4.2.3.</span> <span class="toc-text">购物车信息怎么存?</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%B4%AD%E7%89%A9%E8%BD%A6%E8%BF%98%E5%8F%AF%E4%BB%A5%E5%AD%98localstorage-%E6%89%8B%E6%9C%BA%E7%AB%AF%E4%B9%9F%E6%9C%89localstorage%EF%BC%8C%E5%9C%A8web%E7%AB%AF%E5%81%9A%E4%B8%80%E4%BA%9B%E6%93%8D%E4%BD%9C%EF%BC%8C%E5%85%88%E8%AF%BB%E5%8F%96redis-%E7%84%B6%E5%90%8E%E8%A6%86%E7%9B%96%E6%95%B0%E6%8D%AE%EF%BC%8C%E4%BD%BF%E7%94%A8localstorage%E5%90%8C%E6%AD%A5%E3%80%82%E6%89%80%E4%BB%A5%E6%88%91%E4%BB%AC%E5%AD%A6%E4%BC%9A%E7%81%B5%E6%B4%BB%E8%BF%90%E7%94%A8%E3%80%82"><span class="toc-number">6.1.4.2.4.</span> <span class="toc-text">购物车还可以存localstorage,手机端也有localstorage，在web端做一些操作，先读取redis,然后覆盖数据，使用localstorage同步。所以我们学会灵活运用。</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BD%BF%E7%94%A8%E9%9B%86%E5%90%88%E5%AD%98%E5%82%A8%EF%BC%9F"><span class="toc-number">6.1.4.2.5.</span> <span class="toc-text">为什么使用集合存储？</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%9B%86%E5%90%88%E7%9A%84%E7%89%B9%E6%80%A7%E6%98%AF%E5%8E%BB%E9%87%8D%EF%BC%8C%E6%AF%94%E5%A6%82%E5%8F%91%E5%B9%B4%E7%BB%88%E5%A5%96%E6%97%B6%EF%BC%8C%E5%8F%AF%E4%BB%A5%E5%88%86%E6%9E%90%E4%B8%80%E4%B8%AA%E4%BA%BA%E8%AF%B7%E5%81%87%E7%9A%84%E5%A4%9A%E5%B0%91%E7%9A%84%E6%8E%92%E8%A1%8C%E6%A6%9C%E3%80%82"><span class="toc-number">6.1.4.2.6.</span> <span class="toc-text">集合的特性是去重，比如发年终奖时，可以分析一个人请假的多少的排行榜。</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B6%88%E6%81%AF%E6%A8%A1%E5%9D%97"><span class="toc-number">6.1.5.</span> <span class="toc-text">消息模块</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#websocket%E6%9C%89%E4%B8%80%E4%B8%AA%E9%80%81%E8%BE%BE%E7%8E%87%E7%9A%84%E9%97%AE%E9%A2%98%EF%BC%8C%E8%BF%99%E4%B9%9F%E6%98%AF%E7%9B%AE%E5%89%8D%E4%B8%80%E4%B8%AA%E4%B8%96%E7%95%8C%E6%80%A7%E7%9A%84%E9%9A%BE%E9%A2%98%EF%BC%8C%E6%88%91%E4%BB%AC%E6%AF%8F%E4%B8%80%E6%AC%A1%E6%B6%88%E6%81%AF%E6%8E%A8%E9%80%81%E9%83%BD%E4%BC%9A%E6%9C%89%E4%B8%80%E4%B8%AA%E9%80%81%E8%BE%BE%E6%95%B0%EF%BC%8C%E5%BD%93%E4%B8%80%E6%AC%A1%E6%B6%88%E6%81%AF%E6%8E%A8%E9%80%81%E4%BA%A7%E7%94%9F%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8C%E7%9B%AE%E6%A0%87%E7%94%A8%E6%88%B7%E4%B8%AD%E4%BC%9A%E6%9C%89%E4%B8%80%E4%BA%9B%E5%BD%93%E6%97%B6%E5%9C%A8%E7%BA%BF%E5%92%8C%E4%B8%80%E4%BA%9B%E4%B8%8D%E5%9C%A8%E7%BA%BF%E7%9A%84%E3%80%82%E7%B3%BB%E7%BB%9F%E4%BC%9A%E6%A0%B9%E6%8D%AE%E7%94%A8%E6%88%B7%E7%9A%84%E7%8A%B6%E6%80%81%E7%AB%8B%E5%8D%B3%E5%90%91%E5%9C%A8%E7%BA%BF%E7%9A%84%E7%94%A8%E6%88%B7%E8%BF%9B%E8%A1%8C%E6%8E%A8%E9%80%81%EF%BC%8C-%E5%BD%93%E6%97%B6%E4%B8%8D%E5%9C%A8%E7%BA%BF%E7%9A%84%E7%94%A8%E6%88%B7%E7%B3%BB%E7%BB%9F%E4%BC%9A%E4%B8%BA%E5%85%B6%E4%BF%9D%E5%AD%98%E7%A6%BB%E7%BA%BF%E6%B6%88%E6%81%AF%EF%BC%8C%E6%B6%88%E6%81%AF%E6%9C%89%E6%95%88%E6%9C%9F%E4%B9%8B%E5%86%85%E7%94%A8%E6%88%B7%E6%81%A2%E5%A4%8D%E7%BD%91%E7%BB%9C%E5%90%8E%EF%BC%8C%E7%B3%BB%E7%BB%9F%E4%BC%9A%E5%B0%86%E7%A6%BB%E7%BA%BF%E6%B6%88%E6%81%AF%E5%8F%91%E9%80%81%E5%88%B0%E7%94%A8%E6%88%B7%E5%AE%A2%E6%88%B7%E7%AB%AF%E3%80%82"><span class="toc-number">6.1.5.0.1.</span> <span class="toc-text">websocket有一个送达率的问题，这也是目前一个世界性的难题，我们每一次消息推送都会有一个送达数，当一次消息推送产生的时候，目标用户中会有一些当时在线和一些不在线的。系统会根据用户的状态立即向在线的用户进行推送， 当时不在线的用户系统会为其保存离线消息，消息有效期之内用户恢复网络后，系统会将离线消息发送到用户客户端。</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%99%84%E4%B8%8A%E6%B6%88%E6%81%AF%E6%A8%A1%E5%9D%97%E4%BB%A3%E7%A0%81"><span class="toc-number">6.1.5.0.2.</span> <span class="toc-text">附上消息模块代码</span></a></li></ol></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/10/19/%E6%95%B4%E6%95%B0%E5%8F%8D%E8%BD%AC/" title="整数反转"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://jsd.012700.xyz/gh/jerryc127/butterfly_cdn@2.1.0/top_img/index.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="整数反转"/></a><div class="content"><a class="title" href="/2023/10/19/%E6%95%B4%E6%95%B0%E5%8F%8D%E8%BD%AC/" title="整数反转">整数反转</a><time datetime="2023-10-19T09:55:58.310Z" title="發表於 2023-10-19 17:55:58">2023-10-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/10/19/%E7%A7%BB%E9%99%A4%E5%85%83%E7%B4%A0/" title="移除元素"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://jsd.012700.xyz/gh/jerryc127/butterfly_cdn@2.1.0/top_img/index.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="移除元素"/></a><div class="content"><a class="title" href="/2023/10/19/%E7%A7%BB%E9%99%A4%E5%85%83%E7%B4%A0/" title="移除元素">移除元素</a><time datetime="2023-10-19T09:55:58.310Z" title="發表於 2023-10-19 17:55:58">2023-10-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/10/19/%E7%BD%97%E9%A9%AC%E6%95%B0%E5%AD%97%E8%BD%AC%E6%95%B4%E6%95%B0/" title="罗马数字转整数"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://jsd.012700.xyz/gh/jerryc127/butterfly_cdn@2.1.0/top_img/index.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="罗马数字转整数"/></a><div class="content"><a class="title" href="/2023/10/19/%E7%BD%97%E9%A9%AC%E6%95%B0%E5%AD%97%E8%BD%AC%E6%95%B4%E6%95%B0/" title="罗马数字转整数">罗马数字转整数</a><time datetime="2023-10-19T09:55:58.310Z" title="發表於 2023-10-19 17:55:58">2023-10-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/10/19/%E5%9B%9E%E6%96%87%E6%95%B0/" title="回文数"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://jsd.012700.xyz/gh/jerryc127/butterfly_cdn@2.1.0/top_img/index.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="回文数"/></a><div class="content"><a class="title" href="/2023/10/19/%E5%9B%9E%E6%96%87%E6%95%B0/" title="回文数">回文数</a><time datetime="2023-10-19T09:55:58.309Z" title="發表於 2023-10-19 17:55:58">2023-10-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/10/19/%E4%B8%A4%E6%95%B0%E4%B9%8B%E5%92%8C/" title="两数之和"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://jsd.012700.xyz/gh/jerryc127/butterfly_cdn@2.1.0/top_img/index.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="两数之和"/></a><div class="content"><a class="title" href="/2023/10/19/%E4%B8%A4%E6%95%B0%E4%B9%8B%E5%92%8C/" title="两数之和">两数之和</a><time datetime="2023-10-19T09:55:58.308Z" title="發表於 2023-10-19 17:55:58">2023-10-19</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2023 By 车 川</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主題 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="閱讀模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="淺色和深色模式轉換"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="單欄和雙欄切換"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="設定"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目錄"><i class="fas fa-list-ul"></i></button><button id="chat-btn" type="button" title="聊天"><i class="fas fa-sms"></i></button><a id="to_comment" href="#post-comment" title="直達評論"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="返回頂部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><div class="js-pjax"><script>(() => {
  const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaid.length === 0) return
  const runMermaid = () => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    Array.from($mermaid).forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
      const mermaidID = 'mermaid-' + index
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)

      const renderV10 = () => {
        renderFn.then(({svg}) => {
          mermaidSrc.insertAdjacentHTML('afterend', svg)
        })
      }

      const renderV9 = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      typeof renderFn === 'string' ? renderV9(renderFn) : renderV10()
    })
  }

  const loadMermaid = () => {
    window.loadMermaid ? runMermaid() : getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaid)
  }

  btf.addGlobalFn('themeChange', runMermaid, 'mermaid')

  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script><script>(() => {
  const abcjsInit = () => {
    const abcjsFn = () => {
      document.querySelectorAll(".abc-music-sheet").forEach(ele => {
        ABCJS.renderAbc(ele, ele.innerHTML, {responsive: 'resize'})
      })
    }
    
    typeof ABCJS === 'object' ? abcjsFn()
      : getScript('https://cdn.jsdelivr.net/npm/abcjs/dist/abcjs-basic-min.min.js').then(abcjsFn)
  }

  window.pjax ? abcjsInit() : window.addEventListener('load', abcjsInit)
})()</script><script>(() => {
  const initWaline = () => {
    const waline = Waline.init(Object.assign({
      el: '#waline-wrap',
      serverURL: 'comment.cc1204.cn',
      pageview: false,
      dark: 'html[data-theme="dark"]',
      path: window.location.pathname,
      comment: false,
    }, null))
  }

  const loadWaline = async () => {
    if (typeof Waline === 'object') initWaline()
    else {
      await getCSS('https://cdn.jsdelivr.net/npm/@waline/client/dist/waline.min.css')
      await getScript('https://cdn.jsdelivr.net/npm/@waline/client/dist/waline.min.js')
      initWaline()
    }
  }

  if ('Waline' === 'Waline' || !true) {
    if (true) btf.loadComment(document.getElementById('waline-wrap'),loadWaline)
    else setTimeout(loadWaline, 0)
  } else {
    window.loadOtherComment = loadWaline
  }
})()</script></div><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜尋</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  資料庫載入中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜尋文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>